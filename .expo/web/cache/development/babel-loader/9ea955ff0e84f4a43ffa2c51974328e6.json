{"ast":null,"code":"import _extends from \"@babel/runtime/helpers/extends\";\nimport _classCallCheck from \"@babel/runtime/helpers/classCallCheck\";\nimport _createClass from \"@babel/runtime/helpers/createClass\";\nimport _inherits from \"@babel/runtime/helpers/inherits\";\nimport _possibleConstructorReturn from \"@babel/runtime/helpers/possibleConstructorReturn\";\nimport _getPrototypeOf from \"@babel/runtime/helpers/getPrototypeOf\";\nvar _jsxFileName = \"C:\\\\Users\\\\91944\\\\Dropbox\\\\My PC (LAPTOP-4MDLAJMG)\\\\Desktop\\\\react_test2\\\\teacherScreens\\\\ChatClassStudent2.js\";\n\nfunction _createSuper(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct(); return function _createSuperInternal() { var Super = _getPrototypeOf(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = _getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return _possibleConstructorReturn(this, result); }; }\n\nfunction _isNativeReflectConstruct() { if (typeof Reflect === \"undefined\" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === \"function\") return true; try { Date.prototype.toString.call(Reflect.construct(Date, [], function () {})); return true; } catch (e) { return false; } }\n\nimport React, { Component } from 'react';\nimport Text from \"react-native-web/dist/exports/Text\";\nimport View from \"react-native-web/dist/exports/View\";\nimport StyleSheet from \"react-native-web/dist/exports/StyleSheet\";\nimport TouchableOpacity from \"react-native-web/dist/exports/TouchableOpacity\";\nimport Modal from \"react-native-web/dist/exports/Modal\";\nimport ScrollView from \"react-native-web/dist/exports/ScrollView\";\nimport Alert from \"react-native-web/dist/exports/Alert\";\nimport ImageBackground from \"react-native-web/dist/exports/ImageBackground\";\nimport Image from \"react-native-web/dist/exports/Image\";\nimport { Icon, Input, Header, Avatar } from 'react-native-elements';\nimport MyHeader from \"../components/MyHeader\";\nimport { RFValue } from 'react-native-responsive-fontsize';\nimport firebase from 'firebase';\nimport db from \"../config\";\nimport { GiftedChat, Actions, Day } from 'react-native-gifted-chat';\nimport * as ImagePicker from \"expo-image-picker\";\n\nvar ClassUpdate2 = function (_Component) {\n  _inherits(ClassUpdate2, _Component);\n\n  var _super = _createSuper(ClassUpdate2);\n\n  function ClassUpdate2(props) {\n    var _this;\n\n    _classCallCheck(this, ClassUpdate2);\n\n    _this = _super.call(this, props);\n    _this.uid = '';\n    _this.messagesRef = null;\n\n    _this.studentIdToZero = function () {\n      db.collection('students').doc(_this.state.student_email_id).update({\n        first: '0'\n      });\n    };\n\n    _this.fetchImage = function (imageName) {\n      var storageRef = firebase.storage().ref().child(\"user_profiles/\" + imageName);\n      storageRef.getDownloadURL().then(function (url) {\n        _this.setState({\n          image: url\n        });\n      }).catch(function (error) {\n        _this.setState({\n          image: \"https://firebasestorage.googleapis.com/v0/b/inbo-chat-a81c7.appspot.com/o/user_profiles%2F0c3b3adb1a7530892e55ef36d3be6cb8.png?alt=media&token=7818f4b2-e6cf-4342-8666-424c4636a430\"\n        });\n      });\n    };\n\n    _this.getUserDetails = function () {\n      db.collection(\"teacher\").where(\"email_id\", \"==\", _this.state.userid).onSnapshot(function (querySnapshot) {\n        querySnapshot.forEach(function (doc) {\n          _this.setState({\n            name: doc.data().name,\n            grade: doc.data().grade,\n            section: doc.data().section,\n            contact: doc.data().contact,\n            id: doc.data().id,\n            docId: doc.id\n          });\n\n          _this.loadMessages(_this.state.stid + doc.data().class_teacher_grade + doc.data().class_teacher_section, function (message) {\n            _this.setState(function (previousState) {\n              return {\n                messages: GiftedChat.append(previousState.messages, message)\n              };\n            });\n          });\n        });\n      });\n    };\n\n    _this.loadMessages = function (where, callback) {\n      _this.messagesRef = firebase.database().ref(where + 'chatclassteacher');\n\n      _this.messagesRef.off();\n\n      var onReceive = function onReceive(data) {\n        var message = data.val();\n        callback({\n          _id: data.key,\n          text: message.text,\n          createdAt: new Date(message.createdAt),\n          user: {\n            _id: message.user._id,\n            name: message.user.name,\n            avatar: message.user.avatar\n          }\n        });\n      };\n\n      _this.messagesRef.limitToLast(900000).on('child_added', onReceive);\n    };\n\n    _this.state = {\n      userid: firebase.auth().currentUser.email,\n      docId: '',\n      messages: [],\n      name: '',\n      student_grade: _this.props.navigation.getParam(\"details\")[\"grade\"],\n      student_name: _this.props.navigation.getParam(\"details\")[\"name\"],\n      student_email_id: _this.props.navigation.getParam(\"details\")[\"email_id\"],\n      student_section: _this.props.navigation.getParam(\"details\")[\"section\"],\n      docId: '',\n      id: '',\n      image: '',\n      grade: '',\n      stid: _this.props.navigation.getParam(\"details\")[\"id\"]\n    };\n    return _this;\n  }\n\n  _createClass(ClassUpdate2, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      this.getUserDetails();\n      this.fetchImage(this.state.userid);\n    }\n  }, {\n    key: \"sendMessage\",\n    value: function sendMessage(message) {\n      for (var i = 0; i < message.length; i++) {\n        this.messagesRef.push({\n          text: message[i].text,\n          user: message[i].user,\n          createdAt: firebase.database.ServerValue.TIMESTAMP\n        });\n      }\n    }\n  }, {\n    key: \"renderDay\",\n    value: function renderDay(props) {\n      return React.createElement(Day, _extends({}, props, {\n        textStyle: {\n          color: '#000',\n          fontWeight: 'bold',\n          fontSize: RFValue(14)\n        },\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 127,\n          columnNumber: 16\n        }\n      }));\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this2 = this;\n\n      return React.createElement(View, {\n        style: {\n          flex: 1,\n          backgroundColor: '#fff5dc'\n        },\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 132,\n          columnNumber: 13\n        }\n      }, React.createElement(ImageBackground, {\n        source: require(\"../assets/bg.png\"),\n        style: styles.image,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 133,\n          columnNumber: 17\n        }\n      }, React.createElement(View, {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 134,\n          columnNumber: 21\n        }\n      }, React.createElement(Header, {\n        leftComponent: React.createElement(Icon, {\n          name: \"arrow-alt-circle-left\",\n          type: \"font-awesome-5\",\n          color: \"#fff\",\n          solid: false,\n          size: RFValue(40),\n          onPress: function onPress() {\n            return _this2.props.navigation.goBack();\n          },\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 136,\n            columnNumber: 44\n          }\n        }),\n        centerComponent: {\n          text: this.state.student_name,\n          style: {\n            color: '#fabf10',\n            fontSize: 20,\n            fontWeight: \"bold\"\n          }\n        },\n        rightComponent: React.createElement(Image, {\n          source: require(\"../assets/logo.png\"),\n          style: {\n            width: '92%',\n            height: '100%'\n          },\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 138,\n            columnNumber: 45\n          }\n        }),\n        backgroundColor: \"#1338BF\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 135,\n          columnNumber: 25\n        }\n      })), React.createElement(GiftedChat, {\n        messages: this.state.messages,\n        onSend: function onSend(message) {\n          _this2.sendMessage(message);\n        },\n        user: {\n          _id: this.state.userid,\n          name: this.state.name,\n          avatar: this.state.image\n        },\n        scrollToBottom: true,\n        alwaysShowSend: true,\n        renderUsernameOnMessage: true,\n        scrollToBottomComponent: function scrollToBottomComponent() {\n          return React.createElement(Icon, {\n            name: \"arrow-down\",\n            type: \"font-awesome-5\",\n            __self: _this2,\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 159,\n              columnNumber: 29\n            }\n          });\n        },\n        isTyping: true,\n        isLoadingEarlier: true,\n        timeTextStyle: {\n          left: {\n            color: 'green'\n          },\n          right: {\n            color: 'yellow'\n          }\n        },\n        isTyping: true,\n        infiniteScroll: true,\n        renderActions: this.renderActions,\n        showAvatarForEveryMessage: true,\n        renderDay: this.renderDay,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 145,\n          columnNumber: 21\n        }\n      })));\n    }\n  }]);\n\n  return ClassUpdate2;\n}(Component);\n\nexport { ClassUpdate2 as default };\nvar styles = StyleSheet.create({\n  add1: {\n    width: RFValue(65),\n    height: RFValue(65),\n    marginTop: RFValue(20),\n    justifyContent: \"center\",\n    alignItems: \"center\",\n    borderRadius: RFValue(100),\n    backgroundColor: \"#a901ff\",\n    shadowColor: \"#000\",\n    shadowOffset: {\n      width: 0,\n      height: 8\n    },\n    shadowOpacity: 0.44,\n    shadowRadius: 10.32,\n    elevation: 16,\n    marginTop: RFValue(10)\n  },\n  scrollview: {\n    flex: 1,\n    backgroundColor: \"#fff\"\n  },\n  signupView: {\n    flex: 0.05,\n    justifyContent: 'center',\n    alignItems: 'center'\n  },\n  signupText: {\n    fontSize: RFValue(20),\n    fontWeight: \"bold\",\n    color: \"#32867d\"\n  },\n  registerButton: {\n    width: \"75%\",\n    height: RFValue(50),\n    marginTop: RFValue(20),\n    justifyContent: \"center\",\n    alignItems: \"center\",\n    borderRadius: RFValue(3),\n    backgroundColor: \"#32867d\",\n    shadowColor: \"#000\",\n    shadowOffset: {\n      width: 0,\n      height: 8\n    },\n    shadowOpacity: 0.44,\n    shadowRadius: 10.32,\n    elevation: 16,\n    marginTop: RFValue(10)\n  },\n  registerButtonText: {\n    fontSize: RFValue(23),\n    fontWeight: \"bold\",\n    color: \"#fff\"\n  },\n  label: {\n    fontSize: RFValue(17),\n    color: \"#717D7E\",\n    fontWeight: 'bold',\n    paddingLeft: RFValue(10),\n    marginLeft: RFValue(20)\n  },\n  registerButton: {\n    width: \"75%\",\n    height: RFValue(50),\n    marginTop: RFValue(20),\n    justifyContent: \"center\",\n    alignItems: \"center\",\n    borderRadius: RFValue(3),\n    backgroundColor: \"#32867d\",\n    shadowColor: \"#000\",\n    shadowOffset: {\n      width: 0,\n      height: 8\n    },\n    shadowOpacity: 0.44,\n    shadowRadius: 10.32,\n    elevation: 16,\n    marginTop: RFValue(10)\n  },\n  registerButtonText: {\n    fontSize: RFValue(23),\n    fontWeight: \"bold\",\n    color: \"#fff\"\n  },\n  cancelButtonText: {\n    fontSize: RFValue(20),\n    fontWeight: 'bold',\n    color: \"#32867d\",\n    marginTop: RFValue(10)\n  },\n  image: {\n    flex: 1,\n    resizeMode: \"cover\",\n    justifyContent: \"center\",\n    shadowOpacity: 0.3\n  }\n});","map":{"version":3,"sources":["C:/Users/91944/Dropbox/My PC (LAPTOP-4MDLAJMG)/Desktop/react_test2/teacherScreens/ChatClassStudent2.js"],"names":["React","Component","Icon","Input","Header","Avatar","MyHeader","RFValue","firebase","db","GiftedChat","Actions","Day","ImagePicker","ClassUpdate2","props","uid","messagesRef","studentIdToZero","collection","doc","state","student_email_id","update","first","fetchImage","imageName","storageRef","storage","ref","child","getDownloadURL","then","url","setState","image","catch","error","getUserDetails","where","userid","onSnapshot","querySnapshot","forEach","name","data","grade","section","contact","id","docId","loadMessages","stid","class_teacher_grade","class_teacher_section","message","previousState","messages","append","callback","database","off","onReceive","val","_id","key","text","createdAt","Date","user","avatar","limitToLast","on","auth","currentUser","email","student_grade","navigation","getParam","student_name","student_section","i","length","push","ServerValue","TIMESTAMP","color","fontWeight","fontSize","flex","backgroundColor","require","styles","goBack","style","width","height","sendMessage","left","right","renderActions","renderDay","StyleSheet","create","add1","marginTop","justifyContent","alignItems","borderRadius","shadowColor","shadowOffset","shadowOpacity","shadowRadius","elevation","scrollview","signupView","signupText","registerButton","registerButtonText","label","paddingLeft","marginLeft","cancelButtonText","resizeMode"],"mappings":"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","sourcesContent":["import React, { Component } from 'react';\r\nimport {\r\n    Text,\r\n    View,\r\n    StyleSheet,\r\n    TouchableOpacity,\r\n    Modal,\r\n    ScrollView,\r\n    Alert,\r\n    ImageBackground,\r\n    Image\r\n} from 'react-native';\r\nimport { Icon, Input, Header, Avatar } from 'react-native-elements';\r\nimport MyHeader from \"../components/MyHeader\";\r\nimport { RFValue } from 'react-native-responsive-fontsize';\r\nimport firebase from 'firebase'\r\nimport db from '../config';\r\nimport { GiftedChat, Actions, Day, } from 'react-native-gifted-chat';\r\nimport * as ImagePicker from \"expo-image-picker\";\r\n\r\nexport default class ClassUpdate2 extends Component {\r\n    uid = '';\r\n    messagesRef = null;\r\n    constructor(props) {\r\n        super(props);\r\n        this.state = {\r\n            userid: firebase.auth().currentUser.email,\r\n            docId: '',\r\n            messages: [],\r\n            name: '',\r\n            student_grade: this.props.navigation.getParam(\"details\")[\"grade\"],\r\n            student_name: this.props.navigation.getParam(\"details\")[\"name\"],\r\n            student_email_id: this.props.navigation.getParam(\"details\")[\"email_id\"],\r\n            student_section: this.props.navigation.getParam(\"details\")[\"section\"],\r\n            docId: '',\r\n            id: '',\r\n            image: '',\r\n            grade: '',\r\n            stid: this.props.navigation.getParam(\"details\")[\"id\"],\r\n        }\r\n    }\r\n\r\n    studentIdToZero = () => {\r\n        db.collection('students')\r\n            .doc(this.state.student_email_id)\r\n            .update({\r\n                first: '0'\r\n            })\r\n    }\r\n\r\n    fetchImage = (imageName) => {\r\n        var storageRef = firebase\r\n            .storage()\r\n            .ref()\r\n            .child(\"user_profiles/\" + imageName);\r\n\r\n        storageRef\r\n            .getDownloadURL()\r\n            .then((url) => {\r\n                this.setState({ image: url });\r\n            })\r\n            .catch((error) => {\r\n                this.setState({ image: \"https://firebasestorage.googleapis.com/v0/b/inbo-chat-a81c7.appspot.com/o/user_profiles%2F0c3b3adb1a7530892e55ef36d3be6cb8.png?alt=media&token=7818f4b2-e6cf-4342-8666-424c4636a430\" });\r\n            });\r\n    };\r\n\r\n    getUserDetails = () => {\r\n        db.collection(\"teacher\")\r\n            .where(\"email_id\", \"==\", this.state.userid)\r\n            .onSnapshot((querySnapshot) => {\r\n                querySnapshot.forEach((doc) => {\r\n                    this.setState({\r\n                        name: doc.data().name,\r\n                        grade: doc.data().grade,\r\n                        section: doc.data().section,\r\n                        contact: doc.data().contact,\r\n                        id: doc.data().id,\r\n                        docId: doc.id,\r\n                    });\r\n                    this.loadMessages(this.state.stid + doc.data().class_teacher_grade + doc.data().class_teacher_section, (message) => {\r\n                        this.setState((previousState) => {\r\n                            return {\r\n                                messages: GiftedChat.append(previousState.messages, message),\r\n                            };\r\n                        });\r\n                    });\r\n                });\r\n            });\r\n    }\r\n\r\n    componentDidMount() {\r\n        this.getUserDetails();\r\n        this.fetchImage(this.state.userid);\r\n        //this.studentIdToZero();\r\n    }\r\n\r\n    loadMessages = (where, callback) => {\r\n        this.messagesRef = firebase.database().ref(where + 'chatclassteacher');\r\n        this.messagesRef.off();\r\n        const onReceive = (data) => {\r\n            const message = data.val();\r\n            callback({\r\n                _id: data.key,\r\n                text: message.text,\r\n                createdAt: new Date(message.createdAt),\r\n                user: {\r\n                    _id: message.user._id,\r\n                    name: message.user.name,\r\n                    avatar: message.user.avatar\r\n                },\r\n            });\r\n        };\r\n        this.messagesRef.limitToLast(900000).on('child_added', onReceive);\r\n    };\r\n\r\n    sendMessage(message) {\r\n        for (let i = 0; i < message.length; i++) {\r\n            this.messagesRef.push({\r\n                text: message[i].text,\r\n                user: message[i].user,\r\n                createdAt: firebase.database.ServerValue.TIMESTAMP,\r\n            });\r\n        }\r\n    }\r\n\r\n    renderDay(props) {\r\n        return <Day {...props} textStyle={{ color: '#000', fontWeight: 'bold', fontSize: RFValue(14) }} />\r\n    }\r\n\r\n    render() {\r\n        return (\r\n            <View style={{ flex: 1, backgroundColor: '#fff5dc' }}>\r\n                <ImageBackground source={require('../assets/bg.png')} style={styles.image}>\r\n                    <View>\r\n                        <Header\r\n                            leftComponent={<Icon name='arrow-alt-circle-left' type='font-awesome-5' color='#fff' solid={false} size={RFValue(40)} onPress={() => this.props.navigation.goBack()} />}\r\n                            centerComponent={{ text: this.state.student_name, style: { color: '#fabf10', fontSize: 20, fontWeight: \"bold\", } }}\r\n                            rightComponent={<Image\r\n                                source={require('../assets/logo.png')}\r\n                                style={{ width: '92%', height: '100%' }}\r\n                            />}\r\n                            backgroundColor=\"#1338BF\"\r\n                        />\r\n                    </View>\r\n                    <GiftedChat\r\n                        messages={this.state.messages}\r\n                        onSend={(message) => {\r\n                            this.sendMessage(message);\r\n                        }}\r\n                        user={{\r\n                            _id: this.state.userid,\r\n                            name: this.state.name,\r\n                            avatar: this.state.image\r\n                        }}\r\n                        scrollToBottom\r\n                        alwaysShowSend={true}\r\n                        renderUsernameOnMessage={true}\r\n                        scrollToBottomComponent={() => (\r\n                            <Icon name='arrow-down' type='font-awesome-5' />\r\n                        )}\r\n                        isTyping={true}\r\n                        isLoadingEarlier={true}\r\n                        timeTextStyle={{ left: { color: 'green' }, right: { color: 'yellow' } }}\r\n                        isTyping={true}\r\n                        infiniteScroll\r\n                        renderActions={this.renderActions}\r\n                        showAvatarForEveryMessage={true}\r\n                        renderDay={this.renderDay}\r\n                    />\r\n                </ImageBackground>\r\n            </View>\r\n        );\r\n    }\r\n}\r\n\r\nconst styles = StyleSheet.create({\r\n    add1: {\r\n        width: RFValue(65),\r\n        height: RFValue(65),\r\n        marginTop: RFValue(20),\r\n        justifyContent: \"center\",\r\n        alignItems: \"center\",\r\n        borderRadius: RFValue(100),\r\n        backgroundColor: \"#a901ff\",\r\n        shadowColor: \"#000\",\r\n        shadowOffset: {\r\n            width: 0,\r\n            height: 8,\r\n        },\r\n        shadowOpacity: 0.44,\r\n        shadowRadius: 10.32,\r\n        elevation: 16,\r\n        marginTop: RFValue(10),\r\n    },\r\n    scrollview: {\r\n        flex: 1,\r\n        backgroundColor: \"#fff\"\r\n    },\r\n    signupView: {\r\n        flex: 0.05,\r\n        justifyContent: 'center',\r\n        alignItems: 'center'\r\n    },\r\n    signupText: {\r\n        fontSize: RFValue(20),\r\n        fontWeight: \"bold\",\r\n        color: \"#32867d\"\r\n    },\r\n    registerButton: {\r\n        width: \"75%\",\r\n        height: RFValue(50),\r\n        marginTop: RFValue(20),\r\n        justifyContent: \"center\",\r\n        alignItems: \"center\",\r\n        borderRadius: RFValue(3),\r\n        backgroundColor: \"#32867d\",\r\n        shadowColor: \"#000\",\r\n        shadowOffset: {\r\n            width: 0,\r\n            height: 8,\r\n        },\r\n        shadowOpacity: 0.44,\r\n        shadowRadius: 10.32,\r\n        elevation: 16,\r\n        marginTop: RFValue(10),\r\n    },\r\n    registerButtonText: {\r\n        fontSize: RFValue(23),\r\n        fontWeight: \"bold\",\r\n        color: \"#fff\",\r\n    },\r\n    label: {\r\n        fontSize: RFValue(17),\r\n        color: \"#717D7E\",\r\n        fontWeight: 'bold',\r\n        paddingLeft: RFValue(10),\r\n        marginLeft: RFValue(20)\r\n    },\r\n    registerButton: {\r\n        width: \"75%\",\r\n        height: RFValue(50),\r\n        marginTop: RFValue(20),\r\n        justifyContent: \"center\",\r\n        alignItems: \"center\",\r\n        borderRadius: RFValue(3),\r\n        backgroundColor: \"#32867d\",\r\n        shadowColor: \"#000\",\r\n        shadowOffset: {\r\n            width: 0,\r\n            height: 8,\r\n        },\r\n        shadowOpacity: 0.44,\r\n        shadowRadius: 10.32,\r\n        elevation: 16,\r\n        marginTop: RFValue(10),\r\n    },\r\n    registerButtonText: {\r\n        fontSize: RFValue(23),\r\n        fontWeight: \"bold\",\r\n        color: \"#fff\",\r\n    },\r\n    cancelButtonText: {\r\n        fontSize: RFValue(20),\r\n        fontWeight: 'bold',\r\n        color: \"#32867d\",\r\n        marginTop: RFValue(10)\r\n    },\r\n    image: {\r\n        flex: 1,\r\n        resizeMode: \"cover\",\r\n        justifyContent: \"center\",\r\n        shadowOpacity: 0.3,\r\n\r\n    },\r\n})"]},"metadata":{},"sourceType":"module"}